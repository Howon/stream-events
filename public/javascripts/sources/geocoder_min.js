(function(b){var a;if("function"===typeof define&&define.amd)define(["leaflet"],b);else if("undefined"!==typeof module)a=require("leaflet"),module.exports=b(a);else{if("undefined"===typeof window.L)throw"Leaflet must be loaded first";b(window.L)}})(function(b){b.Control.Geocoder=b.Control.extend({options:{showResultIcons:!1,collapsed:!0,expand:"click",position:"topright",placeholder:"Search...",errorMessage:"Nothing found."},_callbackId:0,initialize:function(a){b.Util.setOptions(this,a);this.options.geocoder||
(this.options.geocoder=new b.Control.Geocoder.Nominatim)},onAdd:function(a){var c=b.DomUtil.create("div","leaflet-control-geocoder");b.DomUtil.create("div","leaflet-control-geocoder-icon",c);var d=this._form=b.DomUtil.create("form","leaflet-control-geocoder-form",c);this._map=a;this._container=c;a=this._input=b.DomUtil.create("input");a.type="text";a.placeholder=this.options.placeholder;b.DomEvent.addListener(a,"keydown",this._keydown,this);this._errorElement=document.createElement("div");this._errorElement.className=
"leaflet-control-geocoder-form-no-error";this._errorElement.innerHTML=this.options.errorMessage;this._alts=b.DomUtil.create("ul","leaflet-control-geocoder-alternatives leaflet-control-geocoder-alternatives-minimized");d.appendChild(a);d.appendChild(this._errorElement);c.appendChild(this._alts);b.DomEvent.addListener(d,"submit",this._geocode,this);this._expand();b.DomEvent.disableClickPropagation(c);return c},_geocodeResult:function(a){b.DomUtil.removeClass(this._container,"leaflet-control-geocoder-throbber");
if(1===a.length)this._geocodeResultSelected(a[0]);else if(0<a.length){this._alts.innerHTML="";this._results=a;b.DomUtil.removeClass(this._alts,"leaflet-control-geocoder-alternatives-minimized");for(var c=0;c<a.length;c++)this._alts.appendChild(this._createAlt(a[c],c))}else b.DomUtil.addClass(this._errorElement,"leaflet-control-geocoder-error")},markGeocode:function(a){this._map.fitBounds(a.bbox);this._geocodeMarker&&this._map.removeLayer(this._geocodeMarker);this._geocodeMarker=(new b.Marker(a.center)).bindPopup(a.html||
a.name).addTo(this._map).openPopup();this._map.fireEvent("GeoCoder_getLatLonName",{result:a.properties});return this},_geocode:function(a){b.DomEvent.preventDefault(a);b.DomUtil.addClass(this._container,"leaflet-control-geocoder-throbber");this._clearResults();this.options.geocoder.geocode(this._input.value,this._geocodeResult,this);return!1},_geocodeResultSelected:function(a){this._clearResults();this.markGeocode(a);this._map.fireEvent("GeoCoder_getLatLonName",{result:a.properties})},_expand:function(){b.DomUtil.addClass(this._container,
"leaflet-control-geocoder-expanded");this._input.select()},_clearResults:function(){b.DomUtil.addClass(this._alts,"leaflet-control-geocoder-alternatives-minimized");this._selection=null;b.DomUtil.removeClass(this._errorElement,"leaflet-control-geocoder-error")},_createAlt:function(a,c){var d=document.createElement("li"),e=b.DomUtil.create("a","",d),f=this.options.showResultIcons&&a.icon?b.DomUtil.create("img","",e):null,g=a.html?void 0:document.createTextNode(a.name);f&&(f.src=a.icon);e.href="#";
e.setAttribute("data-result-index",c);a.html?e.innerHTML=a.html:e.appendChild(g);b.DomEvent.addListener(d,"click",function(c){b.DomEvent.preventDefault(c);this._geocodeResultSelected(a)},this);return d},_keydown:function(a){var c=this,d=function(a){c._selection&&(b.DomUtil.removeClass(c._selection.firstChild,"leaflet-control-geocoder-selected"),c._selection=c._selection[0<a?"nextSibling":"previousSibling"]);c._selection||(c._selection=c._alts[0<a?"firstChild":"lastChild"]);c._selection&&b.DomUtil.addClass(c._selection.firstChild,
"leaflet-control-geocoder-selected")};switch(a.keyCode){case 38:d(-1);b.DomEvent.preventDefault(a);break;case 40:d(1);b.DomEvent.preventDefault(a);break;case 13:this._selection&&(d=parseInt(this._selection.firstChild.getAttribute("data-result-index"),10),this._geocodeResultSelected(this._results[d]),this._clearResults(),b.DomEvent.preventDefault(a))}return!0}});b.Control.geocoder=function(a,c){return new b.Control.Geocoder(a,c)};b.Control.Geocoder.callbackId=0;b.Control.Geocoder.jsonp=function(a,
c,d,e,f){var g="_l_geocoder_"+b.Control.Geocoder.callbackId++;c[f||"callback"]=g;window[g]=b.Util.bind(d,e);d=document.createElement("script");d.type="text/javascript";d.src=a+b.Util.getParamString(c);d.id=g;document.getElementsByTagName("head")[0].appendChild(d)};b.Control.Geocoder.getJSON=function(a,c,d){var e=new XMLHttpRequest;e.open("GET",a+b.Util.getParamString(c),!0);e.send(null);e.onreadystatechange=function(){4==e.readyState&&(200!=e.status&&304!=req.status||d(JSON.parse(e.response)))}};
b.Control.Geocoder.template=function(a,c,d){return a.replace(/\{ *([\w_]+) *\}/g,function(a,f){var d=c[f];void 0===d?d="":"function"===typeof d&&(d=d(c));return b.Control.Geocoder.htmlEscape(d)})};b.Control.Geocoder.htmlEscape=function(){function a(a){return e[a]}var b=/[&<>"'`]/g,d=/[&<>"'`]/,e={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"};return function(f){if(null==f)return"";if(!f)return f+"";f=""+f;return d.test(f)?f.replace(b,a):f}}();b.Control.Geocoder.Nominatim=
b.Class.extend({options:{serviceUrl:"//nominatim.openstreetmap.org/",geocodingQueryParams:{},reverseQueryParams:{},htmlTemplate:function(a){a=a.address;var c=[];(a.road||a.building)&&c.push("{building} {road} {house_number}");(a.city||a.town||a.village)&&c.push('<span class="'+(0<c.length?"leaflet-control-geocoder-address-detail":"")+'">{postcode} {city} {town} {village}</span>');(a.state||a.country)&&c.push('<span class="'+(0<c.length?"leaflet-control-geocoder-address-context":"")+'">{state} {country}</span>');
return b.Control.Geocoder.template(c.join("<br/>"),a,!0)}},initialize:function(a){b.Util.setOptions(this,a)},geocode:function(a,c,d){b.Control.Geocoder.jsonp(this.options.serviceUrl+"search/",b.extend({q:a,limit:5,format:"json",addressdetails:1},this.options.geocodingQueryParams),function(a){for(var f=[],g=a.length-1;0<=g;g--){for(var h=a[g].boundingbox,k=0;4>k;k++)h[k]=parseFloat(h[k]);f[g]={name:a[g].display_name,html:this.options.htmlTemplate?this.options.htmlTemplate(a[g]):void 0,bbox:b.latLngBounds([h[0],
h[2]],[h[1],h[3]]),center:b.latLng(a[g].lat,a[g].lon),properties:a[g]}}c.call(d,f)},this,"json_callback")},reverse:function(a,c,d,e){b.Control.Geocoder.jsonp(this.options.serviceUrl+"reverse/",b.extend({lat:a.lat,lon:a.lng,zoom:Math.round(Math.log(c/256)/Math.log(2)),addressdetails:1,format:"json"},this.options.reverseQueryParams),function(a){var c=[],h;a&&a.lat&&a.lon&&(h=b.latLng(a.lat,a.lon),c.push({name:a.display_name,html:this.options.htmlTemplate?this.options.htmlTemplate(a):void 0,center:h,
bounds:b.latLngBounds(h,h),properties:a}));d.call(e,c)},this,"json_callback")}});b.Control.Geocoder.nominatim=function(a){return new b.Control.Geocoder.Nominatim(a)};return b.Control.Geocoder});